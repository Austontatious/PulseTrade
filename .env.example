# --- Core ---
PROJECT_NAME=PulseTrade
PYTHONUNBUFFERED=1

# --- Database ---
POSTGRES_USER=pulse
POSTGRES_PASSWORD=pulsepass
POSTGRES_DB=pulse
POSTGRES_HOST=db
POSTGRES_PORT=5432
DATABASE_URL=postgresql://pulse:pulsepass@db:5432/pulse

# --- Redis/Celery ---
REDIS_URL=redis://redis:6379/0

# --- External APIs (optional but supported) ---
# Alpaca (Data API v2 or Market Data websocket)
ALPACA_API_KEY_ID=your_key
ALPACA_API_SECRET_KEY=your_secret
ALPACA_ACCOUNT_ID=your_account_id
# Alpaca Market Data websockets (both can run concurrently)
ENABLE_ALPACA_IEX_WS=1
ENABLE_ALPACA_SIP_WS=1

# Finnhub / FMP (analyst ratings & estimates)
FINNHUB_API_KEY=your_key
FMP_API_KEY=your_key

# Stocktwits (REST) - public endpoints are rate-limited, many require auth
STOCKTWITS_TOKEN=your_token

# Truth Social (no stable public API - use your scraper or actor token)
TRUTH_SOCIAL_COOKIE=your_cookie_or_token

# Quiver / CapitolTrades (political trades)
QUIVER_API_KEY=your_key
CAPITOLTRADES_BASE=https://www.capitoltrades.com
QUIVER_API_BASE=https://api.quiverquant.com
QUIVER_API_TOKEN=
QUIVER_TIMEOUT=20
QUIVER_ENABLE_PUBLIC_EXTRAS=false
QUIVER_INCLUDE_OPTIONS=false

# --- Feature flags ---
ENABLE_COINBASE=1
ENABLE_KRAKEN=1
ENABLE_ALPACA=0
ENABLE_FINNHUB=0
ENABLE_FMP=0
ENABLE_FMP_SCREENS=1
ENABLE_FMP_SENTIMENT=0
FMP_SENTIMENT_LOOKBACK_DAYS=30
FMP_SENTIMENT_LIMIT=120
ENABLE_FMP_PRICE_TARGET_V4=0
FMP_PRICE_TARGET_LIMIT=200
ENABLE_STOCKTWITS_TRENDING=1
ENABLE_STOCKTWITS=0
ENABLE_TRUTHSOCIAL=0
ENABLE_POLITICS=0
ENABLE_SENTIMENT_SCORING=1

SYMBOLS=AAPL,MSFT,BTCUSD,ETHUSD
# Optional explicit forecast universe (defaults to SYMBOLS)
FORECAST_TICKERS=
FORECAST_MAX_TICKERS=50
HTTP_POLL_SECS=120
TRUTH_SOCIAL_SCRAPER_URL=
USE_TIMESFM=0
USE_CHRONOS=0
ALPACA_SYMBOLS=AAPL,MSFT,SPY
ENABLE_ALPACA_EXECUTOR=0
ALPACA_PAPER_BASE_URL=https://paper-api.alpaca.markets
ALPACA_ORDER_NOTIONAL=10        # dollar notional for market orders (preferred)
ALPACA_TIME_IN_FORCE=gtc
ALPACA_ORDER_TYPE=market
ENABLE_ALPACA_REST=1           # enable REST fallback poller
ENABLE_ALPACA_IEX_REST=1
ENABLE_ALPACA_SIP_REST=0
ALPACA_REST_POLL_SECS=30
ENABLE_SYMBOL_DISCOVERY=1
SYMBOL_DISCOVERY_WINDOW_MIN=30
SYMBOL_DISCOVERY_MIN_MSG_RATE=0.2
SYMBOL_DISCOVERY_MIN_SENTI_ABS=0.1
SYMBOL_DISCOVERY_MAX_ADD=10
SYMBOL_DISCOVERY_SECS=60
ENABLE_UNIVERSE_SEED=1
ALPACA_REST_MAX_PER_CYCLE=50
PLANNER_MAX_TRADE_TICKERS=30

# --- Shorts master ---
PT_ALLOW_SHORTS=true
PT_MAX_SHORT_POS_PCT=0.10        # per-name short cap (10% NAV)
PT_SECTOR_MAX_SHORT_PCT=0.25     # sector cap (short book)
PT_GROSS_MAX_PCT=1.00            # long |short| sum cap
PT_NET_EXPO_MIN=-0.30            # net exposure band (min)
PT_NET_EXPO_MAX=0.70             # net exposure band (max)

# --- Sizing ---
PT_MAX_POS_PCT=0.10            # hard cap: 10% of NAV per single name
PT_SECTOR_MAX_PCT=0.25         # cap any GICS sector to 25% NAV
PT_CASH_FLOOR_PCT=0.05         # keep at least 5% NAV in cash after trades
PT_MIN_ORDER_NOTIONAL=200      # skip dust trades
PT_NO_TRADE_BAND_PCT=0.0025    # 25 bps band: don't trade if weight change is tiny
PT_TOP_N=25                    # only allocate to top-N ideas by score
PT_SCORE_EXP=1.0               # exponent on scores before normalization (1.0 = linear)
PT_TURNOVER_CAP_PCT=0.40       # cap day's turnover to 40% of NAV

# --- Broker / protection ---
PT_REQUIRE_SHORTABLE=true         # require Alpaca shortable & ETB
PT_USE_TRAILING_STOPS=true
PT_TRAIL_BUY_TO_COVER_PCT=0.02    # 2% trailing cover

# --- Replacement logic ---
PT_ENABLE_REPLACEMENT=true
PT_REPLACEMENT_FRIC_BPS=5       # penalize churn by 5 bps when comparing "replace vs hold"
PT_REPLACEMENT_LOOKBACK_D=5     # if we have realized losers, prefer trimming those first

# --- Inputs mapping (where "confidence" comes from) ---
PT_SCORE_FIELD=signal_value_z   # name on your /signals item to read as score
PT_BLOCK_IF_LLM_DENY=true       # require LLM policy allow

# Planner knobs
PLANNER_DEV_THRESH=0.0001
PLANNER_R_MULT=2.0
PLANNER_ATR_MINUTES=10
PLANNER_LIMIT_NOTIONAL=10
PLANNER_COOLDOWN_MINS=5
PLANNER_USE_SENTIMENT=1
PLANNER_USE_FUNDAMENTALS=1
POLICY_ALLOW_ALL_ALPACA=0
PLANNER_ENTRY_ATR_FRAC=0.1
PLANNER_BRACKET_PRICE_MAX=300
POLICY_MAX_SUBMITS_PER_STEP=8
PLANNER_TOP_K=15
PLANNER_Z_DEV_THRESH=1.8
ALPACA_ORDERS_PER_SEC=2
ALPACA_POS_PER_SEC=5

# Strategist (PLUTUS) service
ENABLE_STOCKTWITS_TRENDING=1
STRAT_RECO_SECS=120
STRAT_TUNE_SECS=300
STRAT_RECO_LOOKBACK_MIN=30
STRAT_RECO_TOPK=50
STRAT_TUNE_WINDOW_MIN=15
STRAT_KNOB_TTL_MIN=10
STRATEGIST_GPU=

# Execution quality / filters
MAX_SPREAD_BPS=8
MAX_QUOTE_AGE_SECS=5
ENTRY_SPREAD_FRAC=0.25
USE_VOL_TARGETED=1
RISK_DOLLARS_PER_TRADE=10
ENABLE_EARNINGS_BLACKOUT=1
EARNINGS_BLACKOUT_MIN=30
ENABLE_EXIT_MANAGER=1

# --- Rate limits (per second) ---
RATE_MAX_EVENTS_PER_SEC=500
RATE_MAX_HTTP_PER_SEC=5
ENABLE_FMP_FUNDAMENTALS=0
FMP_FUNDAMENTALS_PERIOD=annual
FMP_FUNDAMENTALS_SINCE=2005-01-01
FORECAST_URL_NBEATS=http://kronos-nbeats:8080
FORECAST_URL_GRAPH=http://kronos-graph:8081
KRONOS_NBEATS_MODEL_DIR=/models/kronos-nbeats/nbeats_XXXXX
KRONOS_NBEATS_API_KEY=changeme
KRONOS_NBEATS_AUTORELOAD=1
KRONOS_CALIBRATION_ENABLED=1
KRONOS_SCENARIOS_API_KEY=changeme
KRONOS_GRAPHX_API_KEY=changeme
KRONOS_TFT_API_KEY=changeme
TRADING_UNIVERSE_VIEW=trading_universe_100
ALLOW_EXIT_OUTSIDE_UNIVERSE=1

# LLM / vLLM
ENABLE_LLM=0
ENABLE_MONTE_CARLO=0
LLM_BASE_URL=http://host.docker.internal:9009/v1
LLM_API_KEY=local-key-not-used
LLM_MODEL=Finance
LLM_DTYPE=float16
LLM_MAX_TOKENS=8192
LLM_GPU_UTILIZATION=0.90
LLM_CUDA_VISIBLE_DEVICES=6

# LLM Prompt controls
LLM_TEMPERATURE=0.2
LLM_TOP_P=0.9
LLM_SEED=42
LLM_MAX_OUTPUT_TOKENS=1024
LLM_POLICY_MIN_LIQUIDITY=2000000
LLM_SHADOW_MODE=false
LLM_AB_BUCKETS=rationale:1.0.0;policy:1.0.0
ORDER_GATE_DISABLED=false
ENABLE_PANIC_EXIT=0
